{"version":3,"file":"piveau-universal-piwik.esm.min.js","sources":["../src/trackers/matomoTracker.js","../src/trackers/utils.js","../src/trackers/piwikProTracker.js","../src/universal-piwik.js"],"sourcesContent":["/* eslint-disable class-methods-use-this */\n/* eslint-disable no-underscore-dangle */\n\nexport default class MatomoTracker {\n  constructor(trackerUrl, siteId, options) {\n    window._paq = window._paq || [];\n    this.type = 'matomo';\n    this.trackerUrl = trackerUrl.slice(-1) === '/' ? trackerUrl : `${trackerUrl}/`;\n    this.siteId = siteId;\n    this.stopped = false;\n    this.options = {\n      debug: false,\n      disabled: false,\n      ...options,\n    };\n\n    if (this.options.disabled) {\n      return new Proxy(this, {\n        get(target, prop) {\n          const origMethod = target[prop];\n          if (typeof origMethod === 'function') {\n            return () => {};\n          }\n          return undefined;\n        },\n      });\n    }\n  }\n\n  // eslint-disable-next-line class-methods-use-this\n  _init() {\n    if (this.options.debug) console.log('init', this.type);\n    const u = this.trackerUrl;\n    window._paq.push(['requireConsent']);\n    window._paq.push(['setTrackerUrl', `${u}matomo.php`]);\n    window._paq.push(['setSiteId', `${this.siteId}`]);\n    const d = document;\n    const g = d.createElement('script');\n    const s = d.getElementsByTagName('script')[0];\n    g.type = 'text/javascript';\n    g.async = true;\n    g.defer = true;\n    g.src = `${u}matomo.js`;\n    s.parentNode.insertBefore(g, s);\n  }\n\n  init() {\n    if (!this.options.immediate) {\n      // eslint-disable-next-line no-underscore-dangle\n      this._init();\n    }\n  }\n\n  consentGiven() {\n    window._paq.push(['rememberConsentGiven']);\n  }\n\n  consentDeclined() {\n    window._paq.push(['forgetConsentGiven']);\n  }\n\n  // eslint-disable-next-line class-methods-use-this\n  consentNoDecision() {}\n\n  trackInteraction() {}\n\n  trackPageView(url, title) {\n    if (url) window._paq.push(['setCustomUrl', url]);\n    if (title) window._paq.push(['setDocumentTitle', title]);\n    window._paq.push(['trackPageView']);\n  }\n\n  trackDatasetDetailsPageView() {}\n\n  trackDownload(url) {\n    window._paq.push(['trackLink', url, 'download']);\n  }\n\n  trackOutlink(url) {\n    window._paq.push(['trackLink', url, 'link']);\n  }\n\n  trackEvent(category, action, name, value) {\n    window._paq.push([\n      'trackEvent',\n      category,\n      ...action ? [action] : [],\n      ...name ? [name] : [],\n      ...value ? [value] : []]);\n  }\n\n  trackGotoResource() {\n    window._paq.push(['trackEvent', 'GoToResource', 'Clicked']);\n  }\n\n  stop() {\n    if (this.options.debug) console.log('Disabling window._paq');\n    window._paq = {\n      push() {},\n    };\n    this.stopped = true;\n  }\n\n  get isStopped() {\n    return !!this.stopped;\n  }\n}\n","function cookieDelete(cookieName) {\n  document.cookie = `${cookieName}=; expires=Thu, 01 Jan 1970 00:00:00 UTC; path=/;`;\n}\n\nfunction deletePiwikCookies() {\n  const allCookies = document.cookie.split(';');\n  for (let cookie = 0; cookie < allCookies.length; cookie += 1) {\n    if ((allCookies[cookie].indexOf('_pk') !== -1) || (allCookies[cookie].indexOf('ppms') !== -1)) {\n      const cookieName = allCookies[cookie].split('=')[0];\n      cookieDelete(cookieName);\n    }\n  }\n}\n\nfunction deletePiwikWebStorage() {\n  window.localStorage.removeItem('ppms_webstorage');\n}\n\nexport default function clearPiwik() {\n  deletePiwikCookies();\n  deletePiwikWebStorage();\n}\n","/* eslint-disable class-methods-use-this */\n/* eslint-disable no-underscore-dangle */\n\nimport MatomoTracker from './matomoTracker';\nimport clearPiwik from './utils';\n\nexport default class PiwikProTracker extends MatomoTracker {\n  constructor(trackerUrl, siteId, options) {\n    super(trackerUrl, siteId, options);\n\n    this.type = 'piwikpro';\n    this._interceptCounter = 0;\n    this.suspended = this.options.suspended || false;\n    this.useSuspendFeature = this.options.useUseSuspendFeature || false;\n    window.dataLayer = window.dataLayer || [];\n\n    if (this.useSuspendFeature) {\n      this._activateSuspendFeature();\n    }\n    const old = window._paq.push;\n\n    // Intercept the following commands\n    // Only intercept their first occurence\n    const interceptCommands = ['enableLinkTracking', 'trackPageView'];\n    const interceptor = (args) => {\n      if (Array.isArray(args) && args.length > 0) {\n        const command = args[0];\n        if (interceptCommands.includes(command)) {\n          if (this.options.debug) console.log('intercept', command);\n          interceptCommands.splice(interceptCommands.indexOf(command), 1);\n          if (interceptCommands.length === 0) {\n            if (this.options.debug) console.log('restore original _paq');\n            window._paq.push = old;\n          }\n          return;\n        }\n      }\n      old.apply(this, [args]);\n    };\n    window._paq.push = interceptor;\n  }\n\n  _activateSuspendFeature() {\n    this.tmpDataLayer = [];\n    this.suspendFilterFn = () => false;\n    const that = this;\n    window.dataLayer = new Proxy([], {\n      get: (target, prop, receiver) => {\n        if (prop === 'push') {\n          return new Proxy(target.push, {\n            apply(_target, thisArg, argumentsList) {\n              return that.suspended && !that.suspendFilterFn(argumentsList)\n                ? that.tmpDataLayer.push(argumentsList[0])\n                : _target.apply(thisArg, argumentsList);\n            },\n          });\n        }\n        return Reflect.get(target, prop, receiver);\n      },\n    });\n  }\n\n  suspendFilter(filterFn) {\n    if (!this.useSuspendFeature) return;\n\n    this.suspended = true;\n    this.suspendFilterFn = typeof filterFn === 'function' ? filterFn : () => false;\n  }\n\n  resume() {\n    if (!this.useSuspendFeature) return;\n    this.suspended = false;\n    this.tmpDataLayer.forEach((item) => {\n      window.dataLayer.push(item);\n    });\n\n    this.tmpDataLayer = [];\n  }\n\n  /* eslint-disable */\n  _init() {\n    if (this.options.debug) if (this.options.debug) console.log('init', this.type);\n    if (this.options.debug) _paq.push(['setUserId', 'dev__debug2']);\n    ((window, document, dataLayerName, id) => {\n      window[dataLayerName] = window[dataLayerName] || [],\n      window[dataLayerName].push({ start: (new Date()).getTime(), event: 'stg.start' });\n      const scripts = document.getElementsByTagName('script')[0]; const\n        tags = document.createElement('script');\n      function stgCreateCookie(a, b, c) { let d = ''; if (c) { const e = new Date(); e.setTime(e.getTime() + 24 * c * 60 * 60 * 1e3), d = `; expires=${e.toUTCString()}`; } document.cookie = `${a}=${b}${d}; path=/`; }\n      const isStgDebug = (window.location.href.match('stg_debug') || document.cookie.match('stg_debug')) && !window.location.href.match('stg_disable_debug'); stgCreateCookie('stg_debug', isStgDebug ? 1 : '', isStgDebug ? 14 : -1);\n      const qP = []; dataLayerName !== 'dataLayer' && qP.push(`data_layer_name=${dataLayerName}`), isStgDebug && qP.push('stg_debug'); const qPString = qP.length > 0 ? (`?${qP.join('&')}`) : '';\n      tags.async = !0, tags.src = `${this.trackerUrl}${id}.js${qPString}`, scripts.parentNode.insertBefore(tags, scripts);\n      // eslint-disable-next-line no-unused-expressions\n      !(function (a, n, i) { a[n] = a[n] || {}; for (let c = 0; c < i.length; c++)!(function (i) { a[n][i] = a[n][i] || {}, a[n][i].api = a[n][i].api || function () { const a = [].slice.call(arguments, 0); typeof a[0] === 'string' && window[dataLayerName].push({ event: `${n}.${i}:${a[0]}`, parameters: [].slice.call(arguments, 1) }); }; }(i[c])); }(window, 'ppms', ['tm', 'cm']));\n    })(window, document, 'dataLayer', this.siteId);\n  }\n  /* eslint-enable */\n\n  init() {\n    if (!this.options.immediate) {\n      // eslint-disable-next-line no-underscore-dangle\n      this._init();\n    }\n  }\n\n  /* eslint-disable */\n  consentGiven() {\n    const new_consent = { consents: { } };\n    new_consent.consents = { analytics: { status: 1 } };\n    window.ppms && window.ppms.cm.api('setComplianceSettings', new_consent, (new_consent) => { console.log(new_consent); });\n  }\n  /* eslint-enable */\n\n  /* eslint-disable */\n  consentDeclined() {\n    const new_consent = { consents: { } };\n    new_consent.consents = { analytics: { status: 0 } };\n    window.ppms && window.ppms.cm.api('setComplianceSettings', new_consent, (new_consent) => {\n      // Optionally do additional tasks (like gdpr compliancy) when user has given no consent\n      if (this.options.removeCookiesWhenNoConsent) setTimeout(clearPiwik, 1000);\n      if (this.options.stopWhenNoConsent) this.stop();\n      console.log(new_consent);\n    });\n  }\n  /* eslint-enable */\n\n  /* eslint-disable */\n  consentNoDecision() {\n    const new_consent = { consents: { } };\n    new_consent.consents = { analytics: { status: -1 } };\n    window.ppms && window.ppms.cm.api('setComplianceSettings', new_consent, (new_consent) => { console.log(new_consent); });\n  }\n  /* eslint-enable */\n\n  /* eslint-disable class-methods-use-this */\n  /* eslint-disable no-underscore-dangle */\n\n  trackInteraction(eventType = 'screen_load', variables = {}) {\n    window.dataLayer.push({\n      event: 'analytics_interaction',\n      event_type: eventType,\n      ...variables,\n    });\n  }\n\n  trackPageView(url, title, { eventType = 'screen_load', metadata = {} }) {\n    this.trackInteraction(eventType, {\n      ...title ? { screen_title: title } : {},\n      ...url ? { page_url: url } : {},\n      ...metadata,\n    });\n  }\n\n  trackDatasetDetailsPageView(url, title, dataset) {\n    this.trackPageView(url, title, {\n      eventType: 'send_dataset_metadata',\n      metadata: dataset,\n    });\n  }\n\n  trackDownload(url) {\n    this.trackInteraction('download', {\n      page_url: url,\n    });\n    super.trackDownload(url);\n  }\n\n  trackOutlink(url) {\n    this.trackInteraction('outlink', {\n      page_url: url,\n    });\n    super.trackOutlink(url);\n  }\n\n  trackGotoResource() {\n    this.trackInteraction('go_to_resource');\n  }\n\n  stop() {\n    if (this.options.debug) console.log('Disabling window.dataLayer');\n    window.dataLayer = {\n      push() {},\n    };\n    super.stop();\n  }\n\n  get isSuspended() {\n    return this.suspended;\n  }\n}\n","/**\n * Vue plugin for streamlining common analytics tasks for both\n * Matomo and PiwikPro\n */\n\nimport MatomoTracker from './trackers/matomoTracker';\nimport PiwikProTracker from './trackers/piwikProTracker';\n\n/**\n * Relevant for PiwikPro only.\n * Prevents from the initial route from being tracked.\n *\n * @see https://gitlab.fokus.fraunhofer.de/piveau/organisation/piveau-scrum-board/-/issues/1602\n */\nlet preventFirstRouteTrack = true;\n\nlet beforeTrackPageViewFn = () => {};\n\n/**\n * Tracks page view on route changes\n * @param {*} router Vue router instance\n * @param {MatomoTracker | PiwikProTracker} tracker Piwik tracker\n */\nfunction trackRouteChanges(router, tracker, options) {\n  const opts = {\n    onlyTrackWithLocale: true,\n    useDatasetsMinScoreFix: false,\n    delay: 1000,\n    trackPagePredicate: true,\n    ...options,\n  };\n\n  router.afterEach((to, from) => {\n    if (tracker.isStopped) return;\n    if (to.meta.ignoreAnalytics) return;\n\n    const isSamePath = to.fullPath === (from && from.fullPath);\n    const isSameRouteName = to.name === from.name;\n    if (isSamePath && isSameRouteName) return;\n    // Workaround: remove duplicated page views for Datasets page\n    // because some default queries being added.\n    // Possible fixes are to either implement dynamic filtering option\n    // or remove that default query mechanism from router\n    // (and add fallback values to store instead)\n    const { query, name } = to;\n    const isDatasetsPage = name === 'Datasets';\n    const hasMinScoring = to.query && ('minScoring' in query);\n    const hasLocale = to.query && ('locale' in to.query);\n    if (opts.onlyTrackWithLocale && !hasLocale) return;\n    if (opts.useDatasetsMinScoreFix && isDatasetsPage && !hasMinScoring) return;\n\n    if (opts.debug && opts.verbose) {\n      console.log('Track page view', from.fullPath, to.fullPath);\n    }\n\n    const url = router.resolve(to.fullPath).href;\n\n    if (beforeTrackPageViewFn && typeof beforeTrackPageViewFn === 'function') {\n      if (opts.verbose) console.log('Before track page view');\n      beforeTrackPageViewFn(to, from, tracker);\n    } else if (typeof beforeTrackPageViewFn !== 'function') {\n      console.warn('beforeTrackPageViewFn must be a function');\n    }\n\n    const trackPagePredicateEval = typeof opts.trackPagePredicate === 'function'\n      ? opts.trackPagePredicate(to, from)\n      : opts.trackPagePredicate;\n    if (!trackPagePredicateEval) {\n      if (opts.verbose) console.log('I will not track this page view due to trackPagePredicate');\n      return;\n    }\n\n    if (tracker.type === 'piwikpro') {\n      if (!preventFirstRouteTrack) {\n        // Workaround: Wait for a set amount of time before tracking the page\n        // in order to send correct page title.\n        // NOTICE: will send incorrect page title when visitor navigates to\n        // another page before the timeout is triggered.\n        setTimeout(() => {\n          tracker.trackPageView(url, `${document.title || to.meta.title}`, {\n            eventType: 'screen_load',\n          });\n        }, opts.delay);\n      } else {\n        // Workaround: send initial 'trackPageView' in the same delayed fashion\n        // instead of letting the init script doing it for you and possibly\n        // sending undefined title page\n        preventFirstRouteTrack = false;\n        if (opts.debug) console.log('Prevent first route track');\n        setTimeout(() => {\n          // eslint-disable-next-line no-underscore-dangle\n          window._paq = window._paq || [];\n          // eslint-disable-next-line no-underscore-dangle\n          window._paq.push(['trackPageView']);\n        }, opts.delay);\n      }\n    } else if (tracker.type === 'matomo') {\n      tracker.trackPageView(url);\n    }\n  });\n}\n\nconst UniversalPiwik = {\n  install(Vue, options) {\n    const opts = {\n      trackerUrl: undefined,\n      siteId: undefined,\n      router: undefined,\n      isPiwikPro: false,\n      debug: false,\n      immediate: false,\n      removeCookiesWhenNoConsent: true,\n      stopWhenNoConsent: true,\n      useSuspendFeature: false,\n      verbose: false,\n      disabled: false,\n      pageViewOptions: {\n        useDatasetsMinScoreFix: false,\n        onlyTrackWithLocale: true,\n        delay: 1000,\n        beforeTrackPageView: () => {},\n        trackPagePredicate: true,\n      },\n      ...options,\n    };\n\n    if (opts.debug && opts.verbose) {\n      console.log('options = ', opts);\n    }\n\n    if (!opts.trackerUrl || !opts.siteId) {\n      // eslint-disable-next-line no-console\n      console.error('Error: trackerUrl or siteId is not specified');\n    }\n\n    // If no trackerUrl, use MatomoTracker as fallback so that tracking goes into limbo\n    // inside _paq\n    const trackerParams = [\n      opts.trackerUrl,\n      opts.siteId,\n      {\n        debug: opts.debug,\n        immediate: opts.immediate,\n        removeCookiesWhenNoConsent: opts.removeCookiesWhenNoConsent,\n        stopWhenNoConsent: opts.stopWhenNoConsent,\n        disabled: opts.disabled,\n        useSuspendFeature: opts.useSuspendFeature,\n      },\n    ];\n    const tracker = opts.isPiwikPro && opts.trackerUrl\n      ? new PiwikProTracker(...trackerParams)\n      : new MatomoTracker(...trackerParams);\n\n    // eslint-disable-next-line no-underscore-dangle\n    if (opts.immediate) tracker._init();\n\n    if (opts.router) {\n      if (typeof opts.pageViewOptions.beforeTrackPageView === 'function') {\n        beforeTrackPageViewFn = opts.pageViewOptions.beforeTrackPageView;\n      }\n\n      trackRouteChanges(opts.router, tracker, {\n        debug: opts.debug, verbose: opts.verbose, ...opts.pageViewOptions,\n      });\n    }\n    Vue.prototype.$piwik = tracker;\n    Vue.prototype.$universalPiwik = {\n      beforeTrackPageView: (cb) => {\n        beforeTrackPageViewFn = cb;\n      },\n    };\n  },\n};\n\nexport default UniversalPiwik;\n"],"names":["MatomoTracker","trackerUrl","siteId","options","_classCallCheck","this","window","_paq","type","slice","concat","stopped","_objectSpread","debug","disabled","Proxy","get","target","prop","console","log","u","push","d","document","g","createElement","s","getElementsByTagName","async","defer","src","parentNode","insertBefore","immediate","_init","value","url","title","category","action","name","_toConsumableArray","cookieDelete","cookieName","cookie","clearPiwik","allCookies","split","length","indexOf","deletePiwikCookies","localStorage","removeItem","PiwikProTracker","_this","_super","call","_interceptCounter","suspended","useSuspendFeature","useUseSuspendFeature","dataLayer","_activateSuspendFeature","old","interceptCommands","args","Array","isArray","command","includes","splice","apply","_assertThisInitialized","tmpDataLayer","suspendFilterFn","that","receiver","_target","thisArg","argumentsList","Reflect","filterFn","forEach","item","_this2","dataLayerName","id","start","Date","getTime","event","scripts","tags","isStgDebug","location","href","match","a","b","c","e","setTime","toUTCString","stgCreateCookie","qP","qPString","join","n","i","api","arguments","parameters","new_consent","consents","analytics","status","ppms","cm","_this3","removeCookiesWhenNoConsent","setTimeout","stopWhenNoConsent","stop","eventType","variables","event_type","_ref","_ref$eventType","_ref$metadata","metadata","trackInteraction","screen_title","page_url","dataset","trackPageView","_get","_getPrototypeOf","prototype","preventFirstRouteTrack","beforeTrackPageViewFn","UniversalPiwik","install","Vue","opts","undefined","router","isPiwikPro","verbose","pageViewOptions","useDatasetsMinScoreFix","onlyTrackWithLocale","delay","beforeTrackPageView","trackPagePredicate","error","trackerParams","tracker","afterEach","to","from","isStopped","meta","ignoreAnalytics","isSamePath","fullPath","isSameRouteName","query","isDatasetsPage","hasMinScoring","hasLocale","resolve","warn","trackRouteChanges","$piwik","$universalPiwik","cb"],"mappings":"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"}