function e(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,o)}return n}function t(t){for(var n=1;n<arguments.length;n++){var o=null!=arguments[n]?arguments[n]:{};n%2?e(Object(o),!0).forEach((function(e){r(t,e,o[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(o)):e(Object(o)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(o,e))}))}return t}function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}function i(e,t,n){return t&&o(e.prototype,t),n&&o(e,n),e}function r(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function a(e){return a=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},a(e)}function c(e,t){return c=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},c(e,t)}function s(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}function u(e,t,n){return u=s()?Reflect.construct:function(e,t,n){var o=[null];o.push.apply(o,t);var i=new(Function.bind.apply(e,o));return n&&c(i,n.prototype),i},u.apply(null,arguments)}function p(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function l(e,t){return!t||"object"!=typeof t&&"function"!=typeof t?p(e):t}function f(e,t,n){return f="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,n){var o=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=a(e)););return e}(e,t);if(o){var i=Object.getOwnPropertyDescriptor(o,t);return i.get?i.get.call(n):i.value}},f(e,t,n||e)}function d(e){return function(e){if(Array.isArray(e))return y(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||function(e,t){if(!e)return;if("string"==typeof e)return y(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return y(e,t)}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function y(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,o=new Array(t);n<t;n++)o[n]=e[n];return o}var h=function(){function e(o,i,r){if(n(this,e),window._paq=window._paq||[],this.type="matomo",this.trackerUrl="/"===o.slice(-1)?o:"".concat(o,"/"),this.siteId=i,this.stopped=!1,this.options=t({debug:!1,disabled:!1},r),this.options.disabled)return new Proxy(this,{get:function(e,t){if("function"==typeof e[t])return function(){}}})}return i(e,[{key:"_init",value:function(){this.options.debug&&console.log("init",this.type);var e=this.trackerUrl;window._paq.push(["requireConsent"]),window._paq.push(["setTrackerUrl","".concat(e,"matomo.php")]),window._paq.push(["setSiteId","".concat(this.siteId)]);var t=document,n=t.createElement("script"),o=t.getElementsByTagName("script")[0];n.type="text/javascript",n.async=!0,n.defer=!0,n.src="".concat(e,"matomo.js"),o.parentNode.insertBefore(n,o)}},{key:"init",value:function(){this.options.immediate||this._init()}},{key:"consentGiven",value:function(){window._paq.push(["rememberConsentGiven"])}},{key:"consentDeclined",value:function(){window._paq.push(["forgetConsentGiven"])}},{key:"consentNoDecision",value:function(){}},{key:"trackInteraction",value:function(){}},{key:"trackPageView",value:function(e,t){e&&window._paq.push(["setCustomUrl",e]),t&&window._paq.push(["setDocumentTitle",t]),window._paq.push(["trackPageView"])}},{key:"trackDatasetDetailsPageView",value:function(){}},{key:"trackDownload",value:function(e){window._paq.push(["trackLink",e,"download"])}},{key:"trackOutlink",value:function(e){window._paq.push(["trackLink",e,"link"])}},{key:"trackEvent",value:function(e,t,n,o){window._paq.push(["trackEvent",e].concat(d(t?[t]:[]),d(n?[n]:[]),d(o?[o]:[])))}},{key:"trackGotoResource",value:function(){window._paq.push(["trackEvent","GoToResource","Clicked"])}},{key:"stop",value:function(){this.options.debug&&console.log("Disabling window._paq"),window._paq={push:function(){}},this.stopped=!0}},{key:"isStopped",get:function(){return!!this.stopped}}]),e}();function w(e){document.cookie="".concat(e,"=; expires=Thu, 01 Jan 1970 00:00:00 UTC; path=/;")}function g(){!function(){for(var e=document.cookie.split(";"),t=0;t<e.length;t+=1)-1===e[t].indexOf("_pk")&&-1===e[t].indexOf("ppms")||w(e[t].split("=")[0])}(),window.localStorage.removeItem("ppms_webstorage")}var v=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&c(e,t)}(d,h);var o,r,u=(o=d,r=s(),function(){var e,t=a(o);if(r){var n=a(this).constructor;e=Reflect.construct(t,arguments,n)}else e=t.apply(this,arguments);return l(this,e)});function d(e,t,o){var i;n(this,d),(i=u.call(this,e,t,o)).type="piwikpro",i._interceptCounter=0,i.suspended=i.options.suspended||!1,i.useSuspendFeature=i.options.useUseSuspendFeature||!1,window.dataLayer=window.dataLayer||[],i.useSuspendFeature&&i._activateSuspendFeature();var r=window._paq.push,a=["enableLinkTracking","trackPageView"];return window._paq.push=function(e){if(Array.isArray(e)&&e.length>0){var t=e[0];if(a.includes(t))return i.options.debug&&console.log("intercept",t),a.splice(a.indexOf(t),1),void(0===a.length&&(i.options.debug&&console.log("restore original _paq"),window._paq.push=r))}r.apply(p(i),[e])},i}return i(d,[{key:"_activateSuspendFeature",value:function(){this.tmpDataLayer=[],this.suspendFilterFn=function(){return!1};var e=this;window.dataLayer=new Proxy([],{get:function(t,n,o){return"push"===n?new Proxy(t.push,{apply:function(t,n,o){return e.suspended&&!e.suspendFilterFn(o)?e.tmpDataLayer.push(o[0]):t.apply(n,o)}}):Reflect.get(t,n,o)}})}},{key:"suspendFilter",value:function(e){this.useSuspendFeature&&(this.suspended=!0,this.suspendFilterFn="function"==typeof e?e:function(){return!1})}},{key:"resume",value:function(){this.useSuspendFeature&&(this.suspended=!1,this.tmpDataLayer.forEach((function(e){window.dataLayer.push(e)})),this.tmpDataLayer=[])}},{key:"_init",value:function(){var e=this;this.options.debug&&this.options.debug&&console.log("init",this.type),this.options.debug&&_paq.push(["setUserId","dev__debug2"]),function(t,n,o,i){t.dataLayer=t.dataLayer||[],t.dataLayer.push({start:(new Date).getTime(),event:"stg.start"});var r=n.getElementsByTagName("script")[0],a=n.createElement("script");var c=(t.location.href.match("stg_debug")||n.cookie.match("stg_debug"))&&!t.location.href.match("stg_disable_debug");!function(e,t,o){var i="";if(o){var r=new Date;r.setTime(r.getTime()+24*o*60*60*1e3),i="; expires=".concat(r.toUTCString())}n.cookie="".concat(e,"=").concat(t).concat(i,"; path=/")}("stg_debug",c?1:"",c?14:-1);var s=[];c&&s.push("stg_debug");var u=s.length>0?"?".concat(s.join("&")):"";a.async=!0,a.src="".concat(e.trackerUrl).concat(i,".js").concat(u),r.parentNode.insertBefore(a,r),function(e,n,o){e[n]=e[n]||{};for(var i=0;i<o.length;i++)!function(o){e[n][o]=e[n][o]||{},e[n][o].api=e[n][o].api||function(){var e=[].slice.call(arguments,0);"string"==typeof e[0]&&t.dataLayer.push({event:"".concat(n,".").concat(o,":").concat(e[0]),parameters:[].slice.call(arguments,1)})}}(o[i])}(t,"ppms",["tm","cm"])}(window,document,0,this.siteId)}},{key:"init",value:function(){this.options.immediate||this._init()}},{key:"consentGiven",value:function(){var e={consents:{}};e.consents={analytics:{status:1}},window.ppms&&window.ppms.cm.api("setComplianceSettings",e,(function(e){console.log(e)}))}},{key:"consentDeclined",value:function(){var e=this,t={consents:{}};t.consents={analytics:{status:0}},window.ppms&&window.ppms.cm.api("setComplianceSettings",t,(function(t){e.options.removeCookiesWhenNoConsent&&setTimeout(g,1e3),e.options.stopWhenNoConsent&&e.stop(),console.log(t)}))}},{key:"consentNoDecision",value:function(){var e={consents:{}};e.consents={analytics:{status:-1}},window.ppms&&window.ppms.cm.api("setComplianceSettings",e,(function(e){console.log(e)}))}},{key:"trackInteraction",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"screen_load",n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};window.dataLayer.push(t({event:"analytics_interaction",event_type:e},n))}},{key:"trackPageView",value:function(e,n,o){var i=o.eventType,r=void 0===i?"screen_load":i,a=o.metadata,c=void 0===a?{}:a;this.trackInteraction(r,t(t(t({},n?{screen_title:n}:{}),e?{page_url:e}:{}),c))}},{key:"trackDatasetDetailsPageView",value:function(e,t,n){this.trackPageView(e,t,{eventType:"send_dataset_metadata",metadata:n})}},{key:"trackDownload",value:function(e){this.trackInteraction("download",{page_url:e}),f(a(d.prototype),"trackDownload",this).call(this,e)}},{key:"trackOutlink",value:function(e){this.trackInteraction("outlink",{page_url:e}),f(a(d.prototype),"trackOutlink",this).call(this,e)}},{key:"trackGotoResource",value:function(){this.trackInteraction("go_to_resource")}},{key:"stop",value:function(){this.options.debug&&console.log("Disabling window.dataLayer"),window.dataLayer={push:function(){}},f(a(d.prototype),"stop",this).call(this)}},{key:"isSuspended",get:function(){return this.suspended}}]),d}(),k=!0,m=function(){};var b={install:function(e,n){var o=t({trackerUrl:void 0,siteId:void 0,router:void 0,isPiwikPro:!1,debug:!1,immediate:!1,removeCookiesWhenNoConsent:!0,stopWhenNoConsent:!0,useSuspendFeature:!1,verbose:!1,disabled:!1,pageViewOptions:{useDatasetsMinScoreFix:!1,onlyTrackWithLocale:!0,delay:1e3,beforeTrackPageView:function(){},trackPagePredicate:!0}},n);o.debug&&o.verbose&&console.log("options = ",o),o.trackerUrl&&o.siteId||console.error("Error: trackerUrl or siteId is not specified");var i=[o.trackerUrl,o.siteId,{debug:o.debug,immediate:o.immediate,removeCookiesWhenNoConsent:o.removeCookiesWhenNoConsent,stopWhenNoConsent:o.stopWhenNoConsent,disabled:o.disabled,useSuspendFeature:o.useSuspendFeature}],r=o.isPiwikPro&&o.trackerUrl?u(v,i):u(h,i);o.immediate&&r._init(),o.router&&("function"==typeof o.pageViewOptions.beforeTrackPageView&&(m=o.pageViewOptions.beforeTrackPageView),function(e,n,o){var i=t({onlyTrackWithLocale:!0,useDatasetsMinScoreFix:!1,delay:1e3,trackPagePredicate:!0},o);e.afterEach((function(t,o){if(!n.isStopped&&!t.meta.ignoreAnalytics){var r=t.fullPath===(o&&o.fullPath),a=t.name===o.name;if(!r||!a){var c=t.query,s="Datasets"===t.name,u=t.query&&"minScoring"in c,p=t.query&&"locale"in t.query;if((!i.onlyTrackWithLocale||p)&&(!i.useDatasetsMinScoreFix||!s||u)){i.debug&&i.verbose&&console.log("Track page view",o.fullPath,t.fullPath);var l=e.resolve(t.fullPath).href;m&&"function"==typeof m?(i.verbose&&console.log("Before track page view"),m(t,o,n)):"function"!=typeof m&&console.warn("beforeTrackPageViewFn must be a function"),("function"==typeof i.trackPagePredicate?i.trackPagePredicate(t,o):i.trackPagePredicate)?"piwikpro"===n.type?k?(k=!1,i.debug&&console.log("Prevent first route track"),setTimeout((function(){window._paq=window._paq||[],window._paq.push(["trackPageView"])}),i.delay)):setTimeout((function(){n.trackPageView(l,"".concat(document.title||t.meta.title),{eventType:"screen_load"})}),i.delay):"matomo"===n.type&&n.trackPageView(l):i.verbose&&console.log("I will not track this page view due to trackPagePredicate")}}}}))}(o.router,r,t({debug:o.debug,verbose:o.verbose},o.pageViewOptions))),e.prototype.$piwik=r,e.prototype.$universalPiwik={beforeTrackPageView:function(e){m=e}}}};export{b as default};
//# sourceMappingURL=piveau-universal-piwik.esm.min.js.map
