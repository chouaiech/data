{"version":3,"file":"piveau-universal-piwik.umd.js","sources":["../src/trackers/matomoTracker.js","../src/trackers/utils.js","../src/trackers/piwikProTracker.js","../src/universal-piwik.js"],"sourcesContent":["/* eslint-disable class-methods-use-this */\n/* eslint-disable no-underscore-dangle */\n\nexport default class MatomoTracker {\n  constructor(trackerUrl, siteId, options) {\n    window._paq = window._paq || [];\n    this.type = 'matomo';\n    this.trackerUrl = trackerUrl.slice(-1) === '/' ? trackerUrl : `${trackerUrl}/`;\n    this.siteId = siteId;\n    this.stopped = false;\n    this.options = {\n      debug: false,\n      disabled: false,\n      ...options,\n    };\n\n    if (this.options.disabled) {\n      return new Proxy(this, {\n        get(target, prop) {\n          const origMethod = target[prop];\n          if (typeof origMethod === 'function') {\n            return () => {};\n          }\n          return undefined;\n        },\n      });\n    }\n  }\n\n  // eslint-disable-next-line class-methods-use-this\n  _init() {\n    if (this.options.debug) console.log('init', this.type);\n    const u = this.trackerUrl;\n    window._paq.push(['requireConsent']);\n    window._paq.push(['setTrackerUrl', `${u}matomo.php`]);\n    window._paq.push(['setSiteId', `${this.siteId}`]);\n    const d = document;\n    const g = d.createElement('script');\n    const s = d.getElementsByTagName('script')[0];\n    g.type = 'text/javascript';\n    g.async = true;\n    g.defer = true;\n    g.src = `${u}matomo.js`;\n    s.parentNode.insertBefore(g, s);\n  }\n\n  init() {\n    if (!this.options.immediate) {\n      // eslint-disable-next-line no-underscore-dangle\n      this._init();\n    }\n  }\n\n  consentGiven() {\n    window._paq.push(['rememberConsentGiven']);\n  }\n\n  consentDeclined() {\n    window._paq.push(['forgetConsentGiven']);\n  }\n\n  // eslint-disable-next-line class-methods-use-this\n  consentNoDecision() {}\n\n  trackInteraction() {}\n\n  trackPageView(url, title) {\n    if (url) window._paq.push(['setCustomUrl', url]);\n    if (title) window._paq.push(['setDocumentTitle', title]);\n    window._paq.push(['trackPageView']);\n  }\n\n  trackDatasetDetailsPageView() {}\n\n  trackDownload(url) {\n    window._paq.push(['trackLink', url, 'download']);\n  }\n\n  trackOutlink(url) {\n    window._paq.push(['trackLink', url, 'link']);\n  }\n\n  trackEvent(category, action, name, value) {\n    window._paq.push([\n      'trackEvent',\n      category,\n      ...action ? [action] : [],\n      ...name ? [name] : [],\n      ...value ? [value] : []]);\n  }\n\n  trackGotoResource() {\n    window._paq.push(['trackEvent', 'GoToResource', 'Clicked']);\n  }\n\n  stop() {\n    if (this.options.debug) console.log('Disabling window._paq');\n    window._paq = {\n      push() {},\n    };\n    this.stopped = true;\n  }\n\n  get isStopped() {\n    return !!this.stopped;\n  }\n}\n","function cookieDelete(cookieName) {\n  document.cookie = `${cookieName}=; expires=Thu, 01 Jan 1970 00:00:00 UTC; path=/;`;\n}\n\nfunction deletePiwikCookies() {\n  const allCookies = document.cookie.split(';');\n  for (let cookie = 0; cookie < allCookies.length; cookie += 1) {\n    if ((allCookies[cookie].indexOf('_pk') !== -1) || (allCookies[cookie].indexOf('ppms') !== -1)) {\n      const cookieName = allCookies[cookie].split('=')[0];\n      cookieDelete(cookieName);\n    }\n  }\n}\n\nfunction deletePiwikWebStorage() {\n  window.localStorage.removeItem('ppms_webstorage');\n}\n\nexport default function clearPiwik() {\n  deletePiwikCookies();\n  deletePiwikWebStorage();\n}\n","/* eslint-disable class-methods-use-this */\n/* eslint-disable no-underscore-dangle */\n\nimport MatomoTracker from './matomoTracker';\nimport clearPiwik from './utils';\n\nexport default class PiwikProTracker extends MatomoTracker {\n  constructor(trackerUrl, siteId, options) {\n    super(trackerUrl, siteId, options);\n\n    this.type = 'piwikpro';\n    this._interceptCounter = 0;\n    this.suspended = this.options.suspended || false;\n    this.useSuspendFeature = this.options.useUseSuspendFeature || false;\n    window.dataLayer = window.dataLayer || [];\n\n    if (this.useSuspendFeature) {\n      this._activateSuspendFeature();\n    }\n    const old = window._paq.push;\n\n    // Intercept the following commands\n    // Only intercept their first occurence\n    const interceptCommands = ['enableLinkTracking', 'trackPageView'];\n    const interceptor = (args) => {\n      if (Array.isArray(args) && args.length > 0) {\n        const command = args[0];\n        if (interceptCommands.includes(command)) {\n          if (this.options.debug) console.log('intercept', command);\n          interceptCommands.splice(interceptCommands.indexOf(command), 1);\n          if (interceptCommands.length === 0) {\n            if (this.options.debug) console.log('restore original _paq');\n            window._paq.push = old;\n          }\n          return;\n        }\n      }\n      old.apply(this, [args]);\n    };\n    window._paq.push = interceptor;\n  }\n\n  _activateSuspendFeature() {\n    this.tmpDataLayer = [];\n    this.suspendFilterFn = () => false;\n    const that = this;\n    window.dataLayer = new Proxy([], {\n      get: (target, prop, receiver) => {\n        if (prop === 'push') {\n          return new Proxy(target.push, {\n            apply(_target, thisArg, argumentsList) {\n              return that.suspended && !that.suspendFilterFn(argumentsList)\n                ? that.tmpDataLayer.push(argumentsList[0])\n                : _target.apply(thisArg, argumentsList);\n            },\n          });\n        }\n        return Reflect.get(target, prop, receiver);\n      },\n    });\n  }\n\n  suspendFilter(filterFn) {\n    if (!this.useSuspendFeature) return;\n\n    this.suspended = true;\n    this.suspendFilterFn = typeof filterFn === 'function' ? filterFn : () => false;\n  }\n\n  resume() {\n    if (!this.useSuspendFeature) return;\n    this.suspended = false;\n    this.tmpDataLayer.forEach((item) => {\n      window.dataLayer.push(item);\n    });\n\n    this.tmpDataLayer = [];\n  }\n\n  /* eslint-disable */\n  _init() {\n    if (this.options.debug) if (this.options.debug) console.log('init', this.type);\n    if (this.options.debug) _paq.push(['setUserId', 'dev__debug2']);\n    ((window, document, dataLayerName, id) => {\n      window[dataLayerName] = window[dataLayerName] || [],\n      window[dataLayerName].push({ start: (new Date()).getTime(), event: 'stg.start' });\n      const scripts = document.getElementsByTagName('script')[0]; const\n        tags = document.createElement('script');\n      function stgCreateCookie(a, b, c) { let d = ''; if (c) { const e = new Date(); e.setTime(e.getTime() + 24 * c * 60 * 60 * 1e3), d = `; expires=${e.toUTCString()}`; } document.cookie = `${a}=${b}${d}; path=/`; }\n      const isStgDebug = (window.location.href.match('stg_debug') || document.cookie.match('stg_debug')) && !window.location.href.match('stg_disable_debug'); stgCreateCookie('stg_debug', isStgDebug ? 1 : '', isStgDebug ? 14 : -1);\n      const qP = []; dataLayerName !== 'dataLayer' && qP.push(`data_layer_name=${dataLayerName}`), isStgDebug && qP.push('stg_debug'); const qPString = qP.length > 0 ? (`?${qP.join('&')}`) : '';\n      tags.async = !0, tags.src = `${this.trackerUrl}${id}.js${qPString}`, scripts.parentNode.insertBefore(tags, scripts);\n      // eslint-disable-next-line no-unused-expressions\n      !(function (a, n, i) { a[n] = a[n] || {}; for (let c = 0; c < i.length; c++)!(function (i) { a[n][i] = a[n][i] || {}, a[n][i].api = a[n][i].api || function () { const a = [].slice.call(arguments, 0); typeof a[0] === 'string' && window[dataLayerName].push({ event: `${n}.${i}:${a[0]}`, parameters: [].slice.call(arguments, 1) }); }; }(i[c])); }(window, 'ppms', ['tm', 'cm']));\n    })(window, document, 'dataLayer', this.siteId);\n  }\n  /* eslint-enable */\n\n  init() {\n    if (!this.options.immediate) {\n      // eslint-disable-next-line no-underscore-dangle\n      this._init();\n    }\n  }\n\n  /* eslint-disable */\n  consentGiven() {\n    const new_consent = { consents: { } };\n    new_consent.consents = { analytics: { status: 1 } };\n    window.ppms && window.ppms.cm.api('setComplianceSettings', new_consent, (new_consent) => { console.log(new_consent); });\n  }\n  /* eslint-enable */\n\n  /* eslint-disable */\n  consentDeclined() {\n    const new_consent = { consents: { } };\n    new_consent.consents = { analytics: { status: 0 } };\n    window.ppms && window.ppms.cm.api('setComplianceSettings', new_consent, (new_consent) => {\n      // Optionally do additional tasks (like gdpr compliancy) when user has given no consent\n      if (this.options.removeCookiesWhenNoConsent) setTimeout(clearPiwik, 1000);\n      if (this.options.stopWhenNoConsent) this.stop();\n      console.log(new_consent);\n    });\n  }\n  /* eslint-enable */\n\n  /* eslint-disable */\n  consentNoDecision() {\n    const new_consent = { consents: { } };\n    new_consent.consents = { analytics: { status: -1 } };\n    window.ppms && window.ppms.cm.api('setComplianceSettings', new_consent, (new_consent) => { console.log(new_consent); });\n  }\n  /* eslint-enable */\n\n  /* eslint-disable class-methods-use-this */\n  /* eslint-disable no-underscore-dangle */\n\n  trackInteraction(eventType = 'screen_load', variables = {}) {\n    window.dataLayer.push({\n      event: 'analytics_interaction',\n      event_type: eventType,\n      ...variables,\n    });\n  }\n\n  trackPageView(url, title, { eventType = 'screen_load', metadata = {} }) {\n    this.trackInteraction(eventType, {\n      ...title ? { screen_title: title } : {},\n      ...url ? { page_url: url } : {},\n      ...metadata,\n    });\n  }\n\n  trackDatasetDetailsPageView(url, title, dataset) {\n    this.trackPageView(url, title, {\n      eventType: 'send_dataset_metadata',\n      metadata: dataset,\n    });\n  }\n\n  trackDownload(url) {\n    this.trackInteraction('download', {\n      page_url: url,\n    });\n    super.trackDownload(url);\n  }\n\n  trackOutlink(url) {\n    this.trackInteraction('outlink', {\n      page_url: url,\n    });\n    super.trackOutlink(url);\n  }\n\n  trackGotoResource() {\n    this.trackInteraction('go_to_resource');\n  }\n\n  stop() {\n    if (this.options.debug) console.log('Disabling window.dataLayer');\n    window.dataLayer = {\n      push() {},\n    };\n    super.stop();\n  }\n\n  get isSuspended() {\n    return this.suspended;\n  }\n}\n","/**\n * Vue plugin for streamlining common analytics tasks for both\n * Matomo and PiwikPro\n */\n\nimport MatomoTracker from './trackers/matomoTracker';\nimport PiwikProTracker from './trackers/piwikProTracker';\n\n/**\n * Relevant for PiwikPro only.\n * Prevents from the initial route from being tracked.\n *\n * @see https://gitlab.fokus.fraunhofer.de/piveau/organisation/piveau-scrum-board/-/issues/1602\n */\nlet preventFirstRouteTrack = true;\n\nlet beforeTrackPageViewFn = () => {};\n\n/**\n * Tracks page view on route changes\n * @param {*} router Vue router instance\n * @param {MatomoTracker | PiwikProTracker} tracker Piwik tracker\n */\nfunction trackRouteChanges(router, tracker, options) {\n  const opts = {\n    onlyTrackWithLocale: true,\n    useDatasetsMinScoreFix: false,\n    delay: 1000,\n    trackPagePredicate: true,\n    ...options,\n  };\n\n  router.afterEach((to, from) => {\n    if (tracker.isStopped) return;\n    if (to.meta.ignoreAnalytics) return;\n\n    const isSamePath = to.fullPath === (from && from.fullPath);\n    const isSameRouteName = to.name === from.name;\n    if (isSamePath && isSameRouteName) return;\n    // Workaround: remove duplicated page views for Datasets page\n    // because some default queries being added.\n    // Possible fixes are to either implement dynamic filtering option\n    // or remove that default query mechanism from router\n    // (and add fallback values to store instead)\n    const { query, name } = to;\n    const isDatasetsPage = name === 'Datasets';\n    const hasMinScoring = to.query && ('minScoring' in query);\n    const hasLocale = to.query && ('locale' in to.query);\n    if (opts.onlyTrackWithLocale && !hasLocale) return;\n    if (opts.useDatasetsMinScoreFix && isDatasetsPage && !hasMinScoring) return;\n\n    if (opts.debug && opts.verbose) {\n      console.log('Track page view', from.fullPath, to.fullPath);\n    }\n\n    const url = router.resolve(to.fullPath).href;\n\n    if (beforeTrackPageViewFn && typeof beforeTrackPageViewFn === 'function') {\n      if (opts.verbose) console.log('Before track page view');\n      beforeTrackPageViewFn(to, from, tracker);\n    } else if (typeof beforeTrackPageViewFn !== 'function') {\n      console.warn('beforeTrackPageViewFn must be a function');\n    }\n\n    const trackPagePredicateEval = typeof opts.trackPagePredicate === 'function'\n      ? opts.trackPagePredicate(to, from)\n      : opts.trackPagePredicate;\n    if (!trackPagePredicateEval) {\n      if (opts.verbose) console.log('I will not track this page view due to trackPagePredicate');\n      return;\n    }\n\n    if (tracker.type === 'piwikpro') {\n      if (!preventFirstRouteTrack) {\n        // Workaround: Wait for a set amount of time before tracking the page\n        // in order to send correct page title.\n        // NOTICE: will send incorrect page title when visitor navigates to\n        // another page before the timeout is triggered.\n        setTimeout(() => {\n          tracker.trackPageView(url, `${document.title || to.meta.title}`, {\n            eventType: 'screen_load',\n          });\n        }, opts.delay);\n      } else {\n        // Workaround: send initial 'trackPageView' in the same delayed fashion\n        // instead of letting the init script doing it for you and possibly\n        // sending undefined title page\n        preventFirstRouteTrack = false;\n        if (opts.debug) console.log('Prevent first route track');\n        setTimeout(() => {\n          // eslint-disable-next-line no-underscore-dangle\n          window._paq = window._paq || [];\n          // eslint-disable-next-line no-underscore-dangle\n          window._paq.push(['trackPageView']);\n        }, opts.delay);\n      }\n    } else if (tracker.type === 'matomo') {\n      tracker.trackPageView(url);\n    }\n  });\n}\n\nconst UniversalPiwik = {\n  install(Vue, options) {\n    const opts = {\n      trackerUrl: undefined,\n      siteId: undefined,\n      router: undefined,\n      isPiwikPro: false,\n      debug: false,\n      immediate: false,\n      removeCookiesWhenNoConsent: true,\n      stopWhenNoConsent: true,\n      useSuspendFeature: false,\n      verbose: false,\n      disabled: false,\n      pageViewOptions: {\n        useDatasetsMinScoreFix: false,\n        onlyTrackWithLocale: true,\n        delay: 1000,\n        beforeTrackPageView: () => {},\n        trackPagePredicate: true,\n      },\n      ...options,\n    };\n\n    if (opts.debug && opts.verbose) {\n      console.log('options = ', opts);\n    }\n\n    if (!opts.trackerUrl || !opts.siteId) {\n      // eslint-disable-next-line no-console\n      console.error('Error: trackerUrl or siteId is not specified');\n    }\n\n    // If no trackerUrl, use MatomoTracker as fallback so that tracking goes into limbo\n    // inside _paq\n    const trackerParams = [\n      opts.trackerUrl,\n      opts.siteId,\n      {\n        debug: opts.debug,\n        immediate: opts.immediate,\n        removeCookiesWhenNoConsent: opts.removeCookiesWhenNoConsent,\n        stopWhenNoConsent: opts.stopWhenNoConsent,\n        disabled: opts.disabled,\n        useSuspendFeature: opts.useSuspendFeature,\n      },\n    ];\n    const tracker = opts.isPiwikPro && opts.trackerUrl\n      ? new PiwikProTracker(...trackerParams)\n      : new MatomoTracker(...trackerParams);\n\n    // eslint-disable-next-line no-underscore-dangle\n    if (opts.immediate) tracker._init();\n\n    if (opts.router) {\n      if (typeof opts.pageViewOptions.beforeTrackPageView === 'function') {\n        beforeTrackPageViewFn = opts.pageViewOptions.beforeTrackPageView;\n      }\n\n      trackRouteChanges(opts.router, tracker, {\n        debug: opts.debug, verbose: opts.verbose, ...opts.pageViewOptions,\n      });\n    }\n    Vue.prototype.$piwik = tracker;\n    Vue.prototype.$universalPiwik = {\n      beforeTrackPageView: (cb) => {\n        beforeTrackPageViewFn = cb;\n      },\n    };\n  },\n};\n\nexport default UniversalPiwik;\n"],"names":["MatomoTracker","trackerUrl","siteId","options","window","_paq","type","slice","stopped","_objectSpread","debug","disabled","Proxy","get","target","prop","origMethod","undefined","console","log","u","push","d","document","g","createElement","s","getElementsByTagName","async","defer","src","parentNode","insertBefore","immediate","_init","url","title","category","action","name","value","cookieDelete","cookieName","cookie","deletePiwikCookies","allCookies","split","length","indexOf","deletePiwikWebStorage","localStorage","removeItem","clearPiwik","PiwikProTracker","_interceptCounter","suspended","useSuspendFeature","useUseSuspendFeature","dataLayer","_activateSuspendFeature","old","interceptCommands","interceptor","args","Array","isArray","command","includes","splice","apply","tmpDataLayer","suspendFilterFn","that","receiver","_target","thisArg","argumentsList","Reflect","filterFn","forEach","item","dataLayerName","id","start","Date","getTime","event","scripts","tags","stgCreateCookie","a","b","c","e","setTime","toUTCString","isStgDebug","location","href","match","qP","qPString","join","n","i","api","call","arguments","parameters","new_consent","consents","analytics","status","ppms","cm","removeCookiesWhenNoConsent","setTimeout","stopWhenNoConsent","stop","eventType","variables","event_type","metadata","trackInteraction","screen_title","page_url","dataset","trackPageView","preventFirstRouteTrack","beforeTrackPageViewFn","trackRouteChanges","router","tracker","opts","onlyTrackWithLocale","useDatasetsMinScoreFix","delay","trackPagePredicate","afterEach","to","from","isStopped","meta","ignoreAnalytics","isSamePath","fullPath","isSameRouteName","query","isDatasetsPage","hasMinScoring","hasLocale","verbose","resolve","warn","trackPagePredicateEval","UniversalPiwik","install","Vue","isPiwikPro","pageViewOptions","beforeTrackPageView","error","trackerParams","prototype","$piwik","$universalPiwik","cb"],"mappings":"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"}