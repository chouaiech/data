{"version":3,"file":"piveau-universal-piwik.esm.js","sources":["../src/trackers/matomoTracker.js","../src/trackers/utils.js","../src/trackers/piwikProTracker.js","../src/universal-piwik.js"],"sourcesContent":["/* eslint-disable class-methods-use-this */\n/* eslint-disable no-underscore-dangle */\n\nexport default class MatomoTracker {\n  constructor(trackerUrl, siteId, options) {\n    window._paq = window._paq || [];\n    this.type = 'matomo';\n    this.trackerUrl = trackerUrl.slice(-1) === '/' ? trackerUrl : `${trackerUrl}/`;\n    this.siteId = siteId;\n    this.stopped = false;\n    this.options = {\n      debug: false,\n      disabled: false,\n      ...options,\n    };\n\n    if (this.options.disabled) {\n      return new Proxy(this, {\n        get(target, prop) {\n          const origMethod = target[prop];\n          if (typeof origMethod === 'function') {\n            return () => {};\n          }\n          return undefined;\n        },\n      });\n    }\n  }\n\n  // eslint-disable-next-line class-methods-use-this\n  _init() {\n    if (this.options.debug) console.log('init', this.type);\n    const u = this.trackerUrl;\n    window._paq.push(['requireConsent']);\n    window._paq.push(['setTrackerUrl', `${u}matomo.php`]);\n    window._paq.push(['setSiteId', `${this.siteId}`]);\n    const d = document;\n    const g = d.createElement('script');\n    const s = d.getElementsByTagName('script')[0];\n    g.type = 'text/javascript';\n    g.async = true;\n    g.defer = true;\n    g.src = `${u}matomo.js`;\n    s.parentNode.insertBefore(g, s);\n  }\n\n  init() {\n    if (!this.options.immediate) {\n      // eslint-disable-next-line no-underscore-dangle\n      this._init();\n    }\n  }\n\n  consentGiven() {\n    window._paq.push(['rememberConsentGiven']);\n  }\n\n  consentDeclined() {\n    window._paq.push(['forgetConsentGiven']);\n  }\n\n  // eslint-disable-next-line class-methods-use-this\n  consentNoDecision() {}\n\n  trackInteraction() {}\n\n  trackPageView(url, title) {\n    if (url) window._paq.push(['setCustomUrl', url]);\n    if (title) window._paq.push(['setDocumentTitle', title]);\n    window._paq.push(['trackPageView']);\n  }\n\n  trackDatasetDetailsPageView() {}\n\n  trackDownload(url) {\n    window._paq.push(['trackLink', url, 'download']);\n  }\n\n  trackOutlink(url) {\n    window._paq.push(['trackLink', url, 'link']);\n  }\n\n  trackEvent(category, action, name, value) {\n    window._paq.push([\n      'trackEvent',\n      category,\n      ...action ? [action] : [],\n      ...name ? [name] : [],\n      ...value ? [value] : []]);\n  }\n\n  trackGotoResource() {\n    window._paq.push(['trackEvent', 'GoToResource', 'Clicked']);\n  }\n\n  stop() {\n    if (this.options.debug) console.log('Disabling window._paq');\n    window._paq = {\n      push() {},\n    };\n    this.stopped = true;\n  }\n\n  get isStopped() {\n    return !!this.stopped;\n  }\n}\n","function cookieDelete(cookieName) {\n  document.cookie = `${cookieName}=; expires=Thu, 01 Jan 1970 00:00:00 UTC; path=/;`;\n}\n\nfunction deletePiwikCookies() {\n  const allCookies = document.cookie.split(';');\n  for (let cookie = 0; cookie < allCookies.length; cookie += 1) {\n    if ((allCookies[cookie].indexOf('_pk') !== -1) || (allCookies[cookie].indexOf('ppms') !== -1)) {\n      const cookieName = allCookies[cookie].split('=')[0];\n      cookieDelete(cookieName);\n    }\n  }\n}\n\nfunction deletePiwikWebStorage() {\n  window.localStorage.removeItem('ppms_webstorage');\n}\n\nexport default function clearPiwik() {\n  deletePiwikCookies();\n  deletePiwikWebStorage();\n}\n","/* eslint-disable class-methods-use-this */\n/* eslint-disable no-underscore-dangle */\n\nimport MatomoTracker from './matomoTracker';\nimport clearPiwik from './utils';\n\nexport default class PiwikProTracker extends MatomoTracker {\n  constructor(trackerUrl, siteId, options) {\n    super(trackerUrl, siteId, options);\n\n    this.type = 'piwikpro';\n    this._interceptCounter = 0;\n    this.suspended = this.options.suspended || false;\n    this.useSuspendFeature = this.options.useUseSuspendFeature || false;\n    window.dataLayer = window.dataLayer || [];\n\n    if (this.useSuspendFeature) {\n      this._activateSuspendFeature();\n    }\n    const old = window._paq.push;\n\n    // Intercept the following commands\n    // Only intercept their first occurence\n    const interceptCommands = ['enableLinkTracking', 'trackPageView'];\n    const interceptor = (args) => {\n      if (Array.isArray(args) && args.length > 0) {\n        const command = args[0];\n        if (interceptCommands.includes(command)) {\n          if (this.options.debug) console.log('intercept', command);\n          interceptCommands.splice(interceptCommands.indexOf(command), 1);\n          if (interceptCommands.length === 0) {\n            if (this.options.debug) console.log('restore original _paq');\n            window._paq.push = old;\n          }\n          return;\n        }\n      }\n      old.apply(this, [args]);\n    };\n    window._paq.push = interceptor;\n  }\n\n  _activateSuspendFeature() {\n    this.tmpDataLayer = [];\n    this.suspendFilterFn = () => false;\n    const that = this;\n    window.dataLayer = new Proxy([], {\n      get: (target, prop, receiver) => {\n        if (prop === 'push') {\n          return new Proxy(target.push, {\n            apply(_target, thisArg, argumentsList) {\n              return that.suspended && !that.suspendFilterFn(argumentsList)\n                ? that.tmpDataLayer.push(argumentsList[0])\n                : _target.apply(thisArg, argumentsList);\n            },\n          });\n        }\n        return Reflect.get(target, prop, receiver);\n      },\n    });\n  }\n\n  suspendFilter(filterFn) {\n    if (!this.useSuspendFeature) return;\n\n    this.suspended = true;\n    this.suspendFilterFn = typeof filterFn === 'function' ? filterFn : () => false;\n  }\n\n  resume() {\n    if (!this.useSuspendFeature) return;\n    this.suspended = false;\n    this.tmpDataLayer.forEach((item) => {\n      window.dataLayer.push(item);\n    });\n\n    this.tmpDataLayer = [];\n  }\n\n  /* eslint-disable */\n  _init() {\n    if (this.options.debug) if (this.options.debug) console.log('init', this.type);\n    if (this.options.debug) _paq.push(['setUserId', 'dev__debug2']);\n    ((window, document, dataLayerName, id) => {\n      window[dataLayerName] = window[dataLayerName] || [],\n      window[dataLayerName].push({ start: (new Date()).getTime(), event: 'stg.start' });\n      const scripts = document.getElementsByTagName('script')[0]; const\n        tags = document.createElement('script');\n      function stgCreateCookie(a, b, c) { let d = ''; if (c) { const e = new Date(); e.setTime(e.getTime() + 24 * c * 60 * 60 * 1e3), d = `; expires=${e.toUTCString()}`; } document.cookie = `${a}=${b}${d}; path=/`; }\n      const isStgDebug = (window.location.href.match('stg_debug') || document.cookie.match('stg_debug')) && !window.location.href.match('stg_disable_debug'); stgCreateCookie('stg_debug', isStgDebug ? 1 : '', isStgDebug ? 14 : -1);\n      const qP = []; dataLayerName !== 'dataLayer' && qP.push(`data_layer_name=${dataLayerName}`), isStgDebug && qP.push('stg_debug'); const qPString = qP.length > 0 ? (`?${qP.join('&')}`) : '';\n      tags.async = !0, tags.src = `${this.trackerUrl}${id}.js${qPString}`, scripts.parentNode.insertBefore(tags, scripts);\n      // eslint-disable-next-line no-unused-expressions\n      !(function (a, n, i) { a[n] = a[n] || {}; for (let c = 0; c < i.length; c++)!(function (i) { a[n][i] = a[n][i] || {}, a[n][i].api = a[n][i].api || function () { const a = [].slice.call(arguments, 0); typeof a[0] === 'string' && window[dataLayerName].push({ event: `${n}.${i}:${a[0]}`, parameters: [].slice.call(arguments, 1) }); }; }(i[c])); }(window, 'ppms', ['tm', 'cm']));\n    })(window, document, 'dataLayer', this.siteId);\n  }\n  /* eslint-enable */\n\n  init() {\n    if (!this.options.immediate) {\n      // eslint-disable-next-line no-underscore-dangle\n      this._init();\n    }\n  }\n\n  /* eslint-disable */\n  consentGiven() {\n    const new_consent = { consents: { } };\n    new_consent.consents = { analytics: { status: 1 } };\n    window.ppms && window.ppms.cm.api('setComplianceSettings', new_consent, (new_consent) => { console.log(new_consent); });\n  }\n  /* eslint-enable */\n\n  /* eslint-disable */\n  consentDeclined() {\n    const new_consent = { consents: { } };\n    new_consent.consents = { analytics: { status: 0 } };\n    window.ppms && window.ppms.cm.api('setComplianceSettings', new_consent, (new_consent) => {\n      // Optionally do additional tasks (like gdpr compliancy) when user has given no consent\n      if (this.options.removeCookiesWhenNoConsent) setTimeout(clearPiwik, 1000);\n      if (this.options.stopWhenNoConsent) this.stop();\n      console.log(new_consent);\n    });\n  }\n  /* eslint-enable */\n\n  /* eslint-disable */\n  consentNoDecision() {\n    const new_consent = { consents: { } };\n    new_consent.consents = { analytics: { status: -1 } };\n    window.ppms && window.ppms.cm.api('setComplianceSettings', new_consent, (new_consent) => { console.log(new_consent); });\n  }\n  /* eslint-enable */\n\n  /* eslint-disable class-methods-use-this */\n  /* eslint-disable no-underscore-dangle */\n\n  trackInteraction(eventType = 'screen_load', variables = {}) {\n    window.dataLayer.push({\n      event: 'analytics_interaction',\n      event_type: eventType,\n      ...variables,\n    });\n  }\n\n  trackPageView(url, title, { eventType = 'screen_load', metadata = {} }) {\n    this.trackInteraction(eventType, {\n      ...title ? { screen_title: title } : {},\n      ...url ? { page_url: url } : {},\n      ...metadata,\n    });\n  }\n\n  trackDatasetDetailsPageView(url, title, dataset) {\n    this.trackPageView(url, title, {\n      eventType: 'send_dataset_metadata',\n      metadata: dataset,\n    });\n  }\n\n  trackDownload(url) {\n    this.trackInteraction('download', {\n      page_url: url,\n    });\n    super.trackDownload(url);\n  }\n\n  trackOutlink(url) {\n    this.trackInteraction('outlink', {\n      page_url: url,\n    });\n    super.trackOutlink(url);\n  }\n\n  trackGotoResource() {\n    this.trackInteraction('go_to_resource');\n  }\n\n  stop() {\n    if (this.options.debug) console.log('Disabling window.dataLayer');\n    window.dataLayer = {\n      push() {},\n    };\n    super.stop();\n  }\n\n  get isSuspended() {\n    return this.suspended;\n  }\n}\n","/**\n * Vue plugin for streamlining common analytics tasks for both\n * Matomo and PiwikPro\n */\n\nimport MatomoTracker from './trackers/matomoTracker';\nimport PiwikProTracker from './trackers/piwikProTracker';\n\n/**\n * Relevant for PiwikPro only.\n * Prevents from the initial route from being tracked.\n *\n * @see https://gitlab.fokus.fraunhofer.de/piveau/organisation/piveau-scrum-board/-/issues/1602\n */\nlet preventFirstRouteTrack = true;\n\nlet beforeTrackPageViewFn = () => {};\n\n/**\n * Tracks page view on route changes\n * @param {*} router Vue router instance\n * @param {MatomoTracker | PiwikProTracker} tracker Piwik tracker\n */\nfunction trackRouteChanges(router, tracker, options) {\n  const opts = {\n    onlyTrackWithLocale: true,\n    useDatasetsMinScoreFix: false,\n    delay: 1000,\n    trackPagePredicate: true,\n    ...options,\n  };\n\n  router.afterEach((to, from) => {\n    if (tracker.isStopped) return;\n    if (to.meta.ignoreAnalytics) return;\n\n    const isSamePath = to.fullPath === (from && from.fullPath);\n    const isSameRouteName = to.name === from.name;\n    if (isSamePath && isSameRouteName) return;\n    // Workaround: remove duplicated page views for Datasets page\n    // because some default queries being added.\n    // Possible fixes are to either implement dynamic filtering option\n    // or remove that default query mechanism from router\n    // (and add fallback values to store instead)\n    const { query, name } = to;\n    const isDatasetsPage = name === 'Datasets';\n    const hasMinScoring = to.query && ('minScoring' in query);\n    const hasLocale = to.query && ('locale' in to.query);\n    if (opts.onlyTrackWithLocale && !hasLocale) return;\n    if (opts.useDatasetsMinScoreFix && isDatasetsPage && !hasMinScoring) return;\n\n    if (opts.debug && opts.verbose) {\n      console.log('Track page view', from.fullPath, to.fullPath);\n    }\n\n    const url = router.resolve(to.fullPath).href;\n\n    if (beforeTrackPageViewFn && typeof beforeTrackPageViewFn === 'function') {\n      if (opts.verbose) console.log('Before track page view');\n      beforeTrackPageViewFn(to, from, tracker);\n    } else if (typeof beforeTrackPageViewFn !== 'function') {\n      console.warn('beforeTrackPageViewFn must be a function');\n    }\n\n    const trackPagePredicateEval = typeof opts.trackPagePredicate === 'function'\n      ? opts.trackPagePredicate(to, from)\n      : opts.trackPagePredicate;\n    if (!trackPagePredicateEval) {\n      if (opts.verbose) console.log('I will not track this page view due to trackPagePredicate');\n      return;\n    }\n\n    if (tracker.type === 'piwikpro') {\n      if (!preventFirstRouteTrack) {\n        // Workaround: Wait for a set amount of time before tracking the page\n        // in order to send correct page title.\n        // NOTICE: will send incorrect page title when visitor navigates to\n        // another page before the timeout is triggered.\n        setTimeout(() => {\n          tracker.trackPageView(url, `${document.title || to.meta.title}`, {\n            eventType: 'screen_load',\n          });\n        }, opts.delay);\n      } else {\n        // Workaround: send initial 'trackPageView' in the same delayed fashion\n        // instead of letting the init script doing it for you and possibly\n        // sending undefined title page\n        preventFirstRouteTrack = false;\n        if (opts.debug) console.log('Prevent first route track');\n        setTimeout(() => {\n          // eslint-disable-next-line no-underscore-dangle\n          window._paq = window._paq || [];\n          // eslint-disable-next-line no-underscore-dangle\n          window._paq.push(['trackPageView']);\n        }, opts.delay);\n      }\n    } else if (tracker.type === 'matomo') {\n      tracker.trackPageView(url);\n    }\n  });\n}\n\nconst UniversalPiwik = {\n  install(Vue, options) {\n    const opts = {\n      trackerUrl: undefined,\n      siteId: undefined,\n      router: undefined,\n      isPiwikPro: false,\n      debug: false,\n      immediate: false,\n      removeCookiesWhenNoConsent: true,\n      stopWhenNoConsent: true,\n      useSuspendFeature: false,\n      verbose: false,\n      disabled: false,\n      pageViewOptions: {\n        useDatasetsMinScoreFix: false,\n        onlyTrackWithLocale: true,\n        delay: 1000,\n        beforeTrackPageView: () => {},\n        trackPagePredicate: true,\n      },\n      ...options,\n    };\n\n    if (opts.debug && opts.verbose) {\n      console.log('options = ', opts);\n    }\n\n    if (!opts.trackerUrl || !opts.siteId) {\n      // eslint-disable-next-line no-console\n      console.error('Error: trackerUrl or siteId is not specified');\n    }\n\n    // If no trackerUrl, use MatomoTracker as fallback so that tracking goes into limbo\n    // inside _paq\n    const trackerParams = [\n      opts.trackerUrl,\n      opts.siteId,\n      {\n        debug: opts.debug,\n        immediate: opts.immediate,\n        removeCookiesWhenNoConsent: opts.removeCookiesWhenNoConsent,\n        stopWhenNoConsent: opts.stopWhenNoConsent,\n        disabled: opts.disabled,\n        useSuspendFeature: opts.useSuspendFeature,\n      },\n    ];\n    const tracker = opts.isPiwikPro && opts.trackerUrl\n      ? new PiwikProTracker(...trackerParams)\n      : new MatomoTracker(...trackerParams);\n\n    // eslint-disable-next-line no-underscore-dangle\n    if (opts.immediate) tracker._init();\n\n    if (opts.router) {\n      if (typeof opts.pageViewOptions.beforeTrackPageView === 'function') {\n        beforeTrackPageViewFn = opts.pageViewOptions.beforeTrackPageView;\n      }\n\n      trackRouteChanges(opts.router, tracker, {\n        debug: opts.debug, verbose: opts.verbose, ...opts.pageViewOptions,\n      });\n    }\n    Vue.prototype.$piwik = tracker;\n    Vue.prototype.$universalPiwik = {\n      beforeTrackPageView: (cb) => {\n        beforeTrackPageViewFn = cb;\n      },\n    };\n  },\n};\n\nexport default UniversalPiwik;\n"],"names":["MatomoTracker","trackerUrl","siteId","options","window","_paq","type","slice","stopped","_objectSpread","debug","disabled","Proxy","get","target","prop","origMethod","undefined","console","log","u","push","d","document","g","createElement","s","getElementsByTagName","async","defer","src","parentNode","insertBefore","immediate","_init","url","title","category","action","name","value","cookieDelete","cookieName","cookie","deletePiwikCookies","allCookies","split","length","indexOf","deletePiwikWebStorage","localStorage","removeItem","clearPiwik","PiwikProTracker","_interceptCounter","suspended","useSuspendFeature","useUseSuspendFeature","dataLayer","_activateSuspendFeature","old","interceptCommands","interceptor","args","Array","isArray","command","includes","splice","apply","tmpDataLayer","suspendFilterFn","that","receiver","_target","thisArg","argumentsList","Reflect","filterFn","forEach","item","dataLayerName","id","start","Date","getTime","event","scripts","tags","stgCreateCookie","a","b","c","e","setTime","toUTCString","isStgDebug","location","href","match","qP","qPString","join","n","i","api","call","arguments","parameters","new_consent","consents","analytics","status","ppms","cm","removeCookiesWhenNoConsent","setTimeout","stopWhenNoConsent","stop","eventType","variables","event_type","metadata","trackInteraction","screen_title","page_url","dataset","trackPageView","preventFirstRouteTrack","beforeTrackPageViewFn","trackRouteChanges","router","tracker","opts","onlyTrackWithLocale","useDatasetsMinScoreFix","delay","trackPagePredicate","afterEach","to","from","isStopped","meta","ignoreAnalytics","isSamePath","fullPath","isSameRouteName","query","isDatasetsPage","hasMinScoring","hasLocale","verbose","resolve","warn","trackPagePredicateEval","UniversalPiwik","install","Vue","isPiwikPro","pageViewOptions","beforeTrackPageView","error","trackerParams","prototype","$piwik","$universalPiwik","cb"],"mappings":"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"}